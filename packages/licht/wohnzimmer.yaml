input_boolean:
  bewegungsmelder_wohnzimmer_deaktiviert:
    name: Bewegungsmelder deaktiviert    
    icon: mdi:sync-off

light:
  - platform: switch
    name: Wohnzimmer Couch
    entity_id: switch.wohnzimmer_couch

  - platform: switch
    name: Wohnzimmer Strahler
    entity_id: switch.wohnzimmer_strahler

  - platform: switch
    name: Wohnzimmer Schrank
    entity_id: switch.wohnzimmer_schrank
    
binary_sensor:
  - platform: template
    sensors:
      bewegungsmelder_inaktiv_tagsueber:
        friendly_name: Bewegungsmelder inaktiv tagsÃ¼ber
        value_template: >
          {% set homeOfficeAktiv = is_state('binary_sensor.home_office_aktiv', 'on') %}
          {% set schlafenAktiv = is_state('binary_sensor.schlafen_aktiv', 'on') %}
        
          {{ False if homeOfficeAktiv or schlafenAktiv else True }}
          
      wohnzimmer_schrank_inaktiv:
        friendly_name: "Wohnzimmer Schrank inaktiv"   
        value_template: "{{ is_state('binary_sensor.nachts', 'on') or is_state('binary_sensor.allein_zu_hause', 'off') }}"
          
      wohnzimmer_couch_inaktiv:
        friendly_name: "Wohnzimmer Couch inaktiv"    
        value_template: "{{ is_state('binary_sensor.nachts', 'off') or is_state('binary_sensor.allein_zu_hause', 'off') }}"          
          
entity_controller:
  bewegung_wohnzimmer_couch:
    friendly_name: "Bewegung Wohnzimmer Couch"
    sensor: binary_sensor.bewegungsmelder_wohnzimmer
    entities: light.wohnzimmer_couch
    delay: 60
    behaviours:
      on_enter_overridden: 'off'    
    overrides:
      - binary_sensor.sonne_tagsueber  
      - binary_sensor.home_office_pause  
      - binary_sensor.wohnzimmer_couch_inaktiv        
      - binary_sensor.bewegungsmelder_inaktiv_tagsueber         
      - binary_sensor.bewegungsmelder_inaktiv_unterwegs
      - binary_sensor.bewegungsmelder_inaktiv_staubsauger
      - input_boolean.bewegungsmelder_wohnzimmer_deaktiviert      
      
  bewegung_wohnzimmer_schrank:
    friendly_name: "Bewegung Wohnzimmer Schrank"
    sensor: binary_sensor.bewegungsmelder_wohnzimmer
    entities: light.wohnzimmer_schrank
    delay: 60
    behaviours:
      on_enter_overridden: 'off'    
    overrides:
      - binary_sensor.sonne_tagsueber  
      - binary_sensor.home_office_pause
      - binary_sensor.wohnzimmer_schrank_inaktiv        
      - binary_sensor.bewegungsmelder_inaktiv_tagsueber         
      - binary_sensor.bewegungsmelder_inaktiv_unterwegs
      - binary_sensor.bewegungsmelder_inaktiv_staubsauger
      - input_boolean.bewegungsmelder_wohnzimmer_deaktiviert    
      
automation:
  - alias: "Wohnzimmer - Licht Abends"
    id: "wohnzimmer_licht_abends"
    trigger:
      - platform: state
        entity_id: binary_sensor.sonne_tagsueber
        to: 'off'
        for: '00:01:00'
    condition:      
      - "{{ (now().hour | int) >= 15 }}"
      - "{{ is_state('person.dennis', 'home') }}"
      - "{{ is_state('binary_sensor.home_office_aktiv', 'off') }}"
      - "{{ is_state('binary_sensor.baden_aktiv', 'off') }}"      
      - "{{ is_state('light.wohnzimmer_couch', 'off') }}"
      - "{{ is_state('light.wohnzimmer_strahler', 'off') }}"
      - "{{ is_state('light.wohnzimmer_schrank', 'off') }}"     
    action:
      - service: light.turn_on
        entity_id: light.wohnzimmer_schrank

  - alias: "Wohnzimmer - Licht Couch"
    id: "wohnzimmer_licht_couch"
    trigger:
      - id: cube_wohnzimmer
        platform: event
        event_type: zha_event
        event_data:
          device_ieee: 00:15:8d:00:01:10:0d:7a
          command: knock   
    condition:
      - condition: or
        conditions:          
          - "{{ is_state('calendar.borussia_dortmund', 'off') }}"
          - "{{ True if '(T.B.A.)' in state_attr('calendar.borussia_dortmund', 'message') else False }}"
      - "{{ is_state('media_player.home_assistant', 'playing') == False }}"
    action:
      - service: light.toggle
        entity_id: light.wohnzimmer_schrank

homeassistant:
  customize:
    light.wohnzimmer_couch:
      icon: mdi:sofa
    light.wohnzimmer_strahler:
      icon: mdi:spotlight
    light.wohnzimmer_schrank:
      icon: mdi:cupboard