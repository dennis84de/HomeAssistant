title: Infomation
path: information
popup_cards:
  sensor.abfahrzeit: 
    title: Ankunftszeit
    card:
      type: entities
      entities:
        - entity: input_select.arbeit_stunden
        - entity: input_select.arbeit_minuten
        - entity: input_select.arbeit_puffer

  input_boolean.home_office:
    title: Arbeitszeiten
    card:
      type: entities
      entities:
        - entity: input_datetime.arbeit_beginn
          name: Beginn
        - entity: input_datetime.arbeit_ende
          name: Ende
        
  sensor.wecker_startzeit:
    title: Einstellungen
    card:
      type: entities
      entities:
        - entity: sensor.tablet_weckzeit
        - entity: input_number.alarmadvance
        - entity: input_number.alarmdelay

  binary_sensor.wecker_ueberspringen:
    title: Wecker überspringen
    card:
      type: entities
      entities:
        - entity: input_boolean.wecker_ueberspringen

  sensor.gewicht:
    title: Gewicht
    card:
      type: entities
      entities:
        - type: custom:mini-graph-card
          name: Gewicht
          line_width: 2
          animate: true
          hours_to_show: 336
          hour24: true
          show:
            icon: false
            state: false
            name: false
            extrema: false
            points: false
          entities:
            - entity: sensor.gewicht
              show_state: false
            - entity: sensor.gewicht_durchschnitt
              name: Durchschnitt
              show_state: false

  binary_sensor.zu_hause:
    title: Geräte
    card:
      type: entities
      entities:
        - entity: person.dennis          
          secondary_info: last-changed
        - entity: device_tracker.handy
          secondary_info: last-changed
        - entity: device_tracker.handygps
          secondary_info: last-changed
        - entity: device_tracker.handymqtt
          secondary_info: last-changed

cards:
  - type: entities
    title: Infos
    show_header_toggle: false
    entities:
      - entity: sensor.countdown_sudtirol
      - entity: binary_sensor.zu_hause
        name: Dennis      
      - entity: sensor.aufenthaltsort_handy
      - entity: proximity.home
      - entity: sensor.letzte_bewegung

  - type: entities
    title: Benachrichtigungen
    show_header_toggle: false
    entities:
      - entity: sensor.telefon_status
      - entity: sensor.handy_status
      - entity: sensor.ungelesene_mails

  - type: entities
    title: Wecker
    show_header_toggle: false
    entities:
      - entity: sensor.wecker_startzeit
        type: "custom:secondaryinfo-entity-row"              
        secondary_info: "[[ sensor.wecker_startdatum ]]"       
      - entity: binary_sensor.alarm_aktiv      
      - entity: binary_sensor.wecker_ueberspringen

  - type: entities
    title: Kalender
    show_header_toggle: false
    entities:
      - entity: calendar.kalender
      - entity: sensor.naechster_urlaub
      - entity: sensor.naechster_feiertag

  - type: entities
    title: Abfallkalender
    show_header_toggle: false
    entities:
      - entity: sensor.edg_restmuell
      - entity: sensor.edg_wertstoff
      - entity: sensor.edg_papier

  - type: conditional
    conditions:
      - entity: sensor.bvb_spiel
        state_not: "-"
    card:
      type: entities
      title: Borussia Dortmund
      show_header_toggle: false
      entities:
        - entity: sensor.bvb_spiel
        - entity: sensor.bvb_datum
        - entity: sensor.bvb_uhrzeit
        - entity: sensor.bvb_ort

  - type: entities
    title: Arbeit
    show_header_toggle: false
    entities:
      - entity: sensor.fahrzeit_zur_arbeit
      - entity: sensor.fahrzeit_nach_hause
      - entity: sensor.abfahrzeit      
      - entity: binary_sensor.schlechtes_wetter      
      - entity: binary_sensor.arbeitstag
      - entity: input_boolean.home_office
      
  - type: custom:mini-graph-card
    name: Fahrzeit
    line_width: 2
    animate: true
    hours_to_show: 168
    points_per_hour: 2
    hour24: true
    show:
      icon: false
      points: false
      state: false
    entities:
      - entity: sensor.fahrzeit_zur_arbeit
      - entity: sensor.fahrzeit_nach_hause

  - type: glance
    title: Tanken
    show_header_toggle: false
    entities:
      - entity: sensor.tankstelle_real
      - entity: binary_sensor.tankstelle_real_status
      - entity: sensor.tankstelle_jet
      - entity: binary_sensor.tankstelle_jet_status

  - type: custom:mini-graph-card
    name: Temperatur
    line_width: 2
    animate: true
    hour24: true
    show:
      fill: false
      icon: false
      points: false
    entities:
      - entity: sensor.wohnzimmer_temperatur
        name: Wohnzimmer
      - entity: sensor.badezimmer_temperatur
        name: Badezimmer
      - entity: sensor.flur_temperatur
        name: Flur
      - entity: sensor.schlafzimmer_temperatur
        name: Schlafzimmer
      - entity: sensor.kueche_temperatur
        name: Küche
      - entity: sensor.arbeitszimmer_temperatur
        name: Arbeitszimmer
      - entity: sensor.sportzimmer_temperatur
        name: Sportzimmer           
           
  - type: entities
    title: Waage
    show_header_toggle: false
    entities:
      - entity: sensor.gewicht
        type: "custom:secondaryinfo-entity-row"
        secondary_info: "Durchschnitt: [[ sensor.gewicht_durchschnitt ]] kg"       
      - entity: sensor.bmi
      - entity: sensor.wasser
      - entity: sensor.fett
              
  - type: conditional
    conditions:
      - entity: sensor.formel1_datum
        state_not: "-"
    card:
      type: entities
      title: Formel 1
      show_header_toggle: false
      entities:
        - entity: sensor.formel1_rennen
        - entity: sensor.formel1_datum
        - entity: sensor.formel1_qualifikation     
        
  - type: custom:atomic-calendar-revive
    name: Serien
    maxDaysToShow: 30
    maxEventCount: 10
    showLocation: false
    disableEventLink: true
    entities:
      - entity: calendar.serien      
        
  - type: markdown
    title: Anrufliste
    content: >-
      {% set callTypeColors = {'incoming':'#268dda', 'outgoing':'#8bbf68', 'missed':'#e45f3b'} %}
      {% set callList = state_attr('sensor.fritzbox_call_list', 'calls') %}
      
      {% if (states('sensor.fritzbox_call_list') == 0) %}
      **<font color={{ callTypeColors['incoming'] }}>Keine Anrufe vorhanden.</font>**
      {% else %}
        {% for call in callList %}
          {% set name = call.name %}
          {% set number = call.number %}
          {% set date = as_timestamp(call.date) | timestamp_custom("%d.%m.%Y, %H:%M", True) %}
          {% set weekday = as_timestamp(call.date) | timestamp_custom("%w", True) | int %}          
          {% set durationSeconds = call.duration | round() %}
          
          {% if call.calltype == 'incoming' %}
            {% set icon = 'mdi:phone-incoming' %}
          {% elif call.calltype == 'outgoing' %}
            {% set icon = 'mdi:phone-outgoing' %}
          {% elif call.calltype == 'missed' %}
            {% set icon = 'mdi:phone-missed' %}
          {% else %}
            {% set icon = 'mdi:phone-hangup' %}
          {% endif %}

          {% if durationSeconds == 0 %}
            {% set duration = '-' %}
          {% elif durationSeconds < 60 %}
            {% set duration = '< 1 Minute' %}
          {% elif durationSeconds >= 60 and durationSeconds < 120 %}
            {% set duration = '1 Minute' %}            
          {% elif durationSeconds >= 120 and durationSeconds < 7200 %}
            {% set duration = (durationSeconds / 60)| round() ~ ' Minuten' %}
          {% elif durationSeconds >= 7200 %}          
           {% set duration = ((durationSeconds / 3600) | round()) ~ ' Stunden' %}           
          {% else %}
            {% set duration = '' %}
          {% endif %}           
          
        <font color={{ callTypeColors[call.calltype] }}> <ha-icon icon="{{ icon }}"></ha-icon></font> {{ name }} ({{ number }})
        *{{ ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'][weekday-1] }}, {{ date }} Uhr*
        *Dauer: {{ duration }}*
        {% endfor %}
      {% endif %}          
        
  - type: custom:stack-in-card
    title: Einkaufen
    cards:
      - type: markdown        
        content: >-
          {% set items = state_attr('sensor.gkeep_einkaufen', 'items') %}
          
          {% if (states('sensor.gkeep_einkaufen') == 0) %}
          *Keine Artikel auf der Einkaufsliste vorhanden.*
          {% else %}
            {% set items = state_attr('sensor.gkeep_einkaufen', 'items') %}
            {% set data = namespace(checked = [], unChecked = []) -%}

            {% for item in items %}
              {% if item.checked == True %}
                {%- set data.checked = data.checked + [item.name] -%}
              {% else %}
                {%- set data.unChecked = data.unChecked + [item.name] -%}
              {% endif %}
            {% endfor %}

            {% for item in data.unChecked %}
            <ha-icon icon="mdi:checkbox-blank-outline"></ha-icon> {{ item }}
            {% endfor %}            
            
            {% if data.checked | length > 0 %}
            ***
            {% for item in data.checked %}
            <font color="#999999"><ha-icon icon="mdi:check-box-outline"></ha-icon> {{ item }}</font>            
            {% endfor %}            
            {% endif %}            
          ***
          {% endif %}              
      - type: entities
        show_header_toggle: false
        entities:
          - entity: input_text.einkaufen
            name: Artikel
          - entity: script.einkaufen_artikel_hinzu
            name: Hinzufügen
          - entity: input_select.einkaufen
            name: Artikel entfernen