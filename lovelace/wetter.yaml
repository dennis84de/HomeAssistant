title: Wetter
path: wetter
popup_cards:
  sensor.darksky_temperature:
    title: Temperatur
    card:
      type: entities
      entities:
        - entity: sensor.darksky_apparent_temperature
        - entity: sensor.darksky_daytime_high_temperature_0d
        - entity: sensor.darksky_overnight_low_temperature_0d
        
  sensor.germany_coronavirus_confirmed:
    title: Corona Virus
    card:
      type: custom:mini-graph-card
      line_width: 2
      animate: true
      hours_to_show: 168
      points_per_hour: 5
      hour24: true
      show:
        icon: false
        points: false
        state: false      
      entities:
        - entity: sensor.germany_coronavirus_confirmed
          name: Bestätigt
        - entity: sensor.germany_coronavirus_current
          name: Aktuell
        - entity: sensor.germany_coronavirus_recovered
          name: Geheilt
        - entity: sensor.germany_coronavirus_deaths
          name: Tote    
          
cards:
  - type: 'custom:dark-sky-weather-card'
    locale: de
    static_icons: true
    tooltips: true
    entity_current_conditions: sensor.darksky_icon
    entity_temperature: sensor.darksky_temperature
    entity_forecast_high_temp_1: sensor.darksky_daytime_high_temperature_1d
    entity_forecast_high_temp_2: sensor.darksky_daytime_high_temperature_2d
    entity_forecast_high_temp_3: sensor.darksky_daytime_high_temperature_3d
    entity_forecast_high_temp_4: sensor.darksky_daytime_high_temperature_4d
    entity_forecast_high_temp_5: sensor.darksky_daytime_high_temperature_5d
    entity_forecast_icon_1: sensor.darksky_icon_1d
    entity_forecast_icon_2: sensor.darksky_icon_2d
    entity_forecast_icon_3: sensor.darksky_icon_3d
    entity_forecast_icon_4: sensor.darksky_icon_4d
    entity_forecast_icon_5: sensor.darksky_icon_5d
    entity_forecast_low_temp_1: sensor.darksky_overnight_low_temperature_0d
    entity_forecast_low_temp_2: sensor.darksky_overnight_low_temperature_1d
    entity_forecast_low_temp_3: sensor.darksky_overnight_low_temperature_2d
    entity_forecast_low_temp_4: sensor.darksky_overnight_low_temperature_3d
    entity_forecast_low_temp_5: sensor.darksky_overnight_low_temperature_4d
    entity_summary_1: sensor.darksky_summary_1d
    entity_summary_2: sensor.darksky_summary_2d
    entity_summary_3: sensor.darksky_summary_3d
    entity_summary_4: sensor.darksky_summary_4d
    entity_summary_5: sensor.darksky_summary_5d
    entity_sun: sun.sun
    entity_visibility: sensor.darksky_visibility
    entity_daytime_high: sensor.darksky_daytime_high_temperature_0d
    entity_wind_bearing: sensor.darksky_wind_bearing
    entity_wind_speed: sensor.darksky_wind_speed
    entity_humidity: sensor.darksky_humidity
    entity_pressure: sensor.darksky_pressure
    entity_apparent_temp: sensor.darksky_apparent_temperature
    entity_daily_summary: sensor.darksky_daily_summary
    entity_pop: sensor.darksky_precip_probability
    entity_pop_intensity: sensor.darksky_precip_intensity
    entity_pop_1: sensor.darksky_precip_probability_1d
    entity_pop_2: sensor.darksky_precip_probability_2d
    entity_pop_3: sensor.darksky_precip_probability_3d
    entity_pop_4: sensor.darksky_precip_probability_4d
    entity_pop_5: sensor.darksky_precip_probability_5d
    entity_current_text: sensor.wetter_text

  - type: entities
    title: Thermometer
    show_header_toggle: false
    entities:
      - entity: sensor.parkplatz_temperatur
        name: Temperatur Parkplatz
      - entity: sensor.parkplatz_luftfeuchtigkeit
        name: Luftfeuchtigkeit Parkplatz
      - entity: sensor.parkplatz_luftdruck
        name: Luftdruck Parkplatz
      - entity: sensor.balkon_temperatur
        name: Temperatur Balkon
      - entity: sensor.balkon_luftfeuchtigkeit
        name: Luftfeuchtigkeit Balkon
      - entity: sensor.balkon_luftdruck
        name: Luftdruck Balkon

  - type: entities
    title: Wetter
    show_header_toggle: false
    entities:
      - entity: sensor.darksky_temperature
      - entity: sensor.wetterlage
  
  - type: markdown
    title: Wetterwarnungen
    content: >-
      {% set level_colors = {0:'#c5e566', 1:'#ffeb3b', 2:'#fb8c00', 3:'#e53935', 4:'#880e4f', 20:'#fe68fe'} %}
      {% set current_count = state_attr("sensor.wetterwarnungen_current_warning_level", "warning_count") %}
      {% set advance_count = state_attr("sensor.wetterwarnungen_advance_warning_level", "warning_count") %}
      {% if ((current_count == 0 or current_count == None) and (advance_count == 0 or advance_count == None)) %}
      **<font color={{ level_colors[0] }}>Keine Warnungen</font>**
      {% else %}
        {% for i in range(current_count) %}
          {% set headline = state_attr("sensor.wetterwarnungen_current_warning_level", "warning_" ~ loop.index ~ "_headline") %}
          {% set description = state_attr("sensor.wetterwarnungen_current_warning_level", "warning_" ~ loop.index ~ "_description") %}
          {% set level = state_attr("sensor.wetterwarnungen_current_warning_level", "warning_" ~ loop.index ~ "_level") %}
          {% set time_start = state_attr("sensor.wetterwarnungen_current_warning_level", "warning_" ~ loop.index ~ "_start") %}
          {% set weekday_start = as_timestamp(time_start) | timestamp_custom("%w", True) | int %}
          {% set time_end = state_attr("sensor.wetterwarnungen_current_warning_level", "warning_" ~ loop.index ~ "_end") %}
          {% set weekday_end = as_timestamp(time_end) | timestamp_custom("%w", True) | int %}
        **<font color={{ level_colors[level] if level_colors[level] is defined else level_colors[1] }}>{{ headline }}</font>**
        {{ ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'][weekday_start-1] }}, {{ time_start.strftime("%H:%M") }} - {{ ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'][weekday_end-1] }}, {{ time_end.strftime("%H:%M") }}        
        *{{ description }}*
        {% if not loop.last %}***{% endif %}
        {% endfor %}
        {% if ((current_count != 0) and (advance_count != 0)) %}***{% endif %}
        {% for i in range(advance_count) %}
          {% set headline = state_attr("sensor.sensor.wetterwarnungen_advance_warning_level", "warning_" ~ loop.index ~ "_headline") %}
          {% set description = state_attr("sensor.sensor.wetterwarnungen_advance_warning_level", "warning_" ~ loop.index ~ "_description") %}
          {% set level = state_attr("sensor.sensor.wetterwarnungen_advance_warning_level", "warning_" ~ loop.index ~ "_level") %}
          {% set time_start = state_attr("sensor.sensor.wetterwarnungen_advance_warning_level", "warning_" ~ loop.index ~ "_start") %}
          {% set weekday_start = as_timestamp(time_start) | timestamp_custom("%w", True) | int %}
          {% set time_end = state_attr("sensor.sensor.wetterwarnungen_advance_warning_level", "warning_" ~ loop.index ~ "_end") %}
          {% set weekday_end = as_timestamp(time_end) | timestamp_custom("%w", True) | int %}
        **<font color={{ level_colors[level] if level_colors[level] is defined else level_colors[1]  }}>{{ headline }}</font>**
        {{ ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'][weekday_start-1] }}, {{ time_start.strftime("%H:%M") }} - {{ ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'][weekday_end-1] }}, {{ time_end.strftime("%H:%M") }}
        *{{ description }}*
        {% if not loop.last %}***{% endif %}
        {% endfor %}
      {% endif %}  
  
  - type: custom:mini-graph-card
    name: Temperatur
    line_width: 2
    animate: true
    hours_to_show: 168
    points_per_hour: 5
    hour24: true
    show:
      fill: false
      icon: false
      points: false
    entities:
      - entity: sensor.parkplatz_temperatur
        name: Parkplatz
      - entity: sensor.balkon_temperatur
        name: Balkon

  - type: entities
    title: Sonne und Mond
    show_header_toggle: false
    entities:
      - entity: sensor.sonnenaufgang
      - entity: sensor.sonnenuntergang
      - entity: sensor.tageszeit
      - entity: sensor.mondphasen

  - type: entities
    title: Regen und Wind
    show_header_toggle: false
    entities:
      - entity: sensor.darksky_precip_intensity
      - entity: sensor.darksky_precip_probability
      - entity: sensor.darksky_cloud_coverage
      - entity: sensor.darksky_wind_speed      
      - entity: sensor.windrichtung

  - type: entities
    title: Luft
    show_header_toggle: false
    entities:
      - entity: sensor.darksky_humidity
      - entity: sensor.darksky_pressure
      - entity: sensor.darksky_ozone
      - entity: sensor.co2_intensity_51_49_7_36

  - type: entities
    title: Sonne
    show_header_toggle: false
    entities:
      - entity: sensor.helligkeit
      - entity: sensor.uv_index_current
      - entity: sensor.uv_index_max
      - entity: sensor.zeit_sonne
      - entity: binary_sensor.protection_window
      - entity: binary_sensor.sommerzeit

  - type: entities
    title: Sonstiges
    show_header_toggle: false
    entities:
      - entity: sensor.flugzeuge
      - entity: binary_sensor.iss
#      - entity: sensor.weltuntergangsuhr
      - entity: sensor.strommix
      - entity: sensor.schimmelindikator
      - entity: binary_sensor.auto_waschen
      - entity: sensor.gdacs_51_485918_7_361026

  - type: entities
    title: Pollen
    show_header_toggle: false
    entities:
      - entity: sensor.pollen_graeser_today
      - entity: sensor.pollen_birke_today
      - entity: sensor.pollen_roggen_today

  - type: entities
    title: SpaceX
    show_header_toggle: false
    entities:
      - entity: sensor.spacex_next_rocket
      - entity: sensor.spacex_next_mission_name
      - entity: sensor.spacex_next_launch_day
      - entity: sensor.spacex_next_launch_time
      - entity: sensor.spacex_next_launch_site

  - type: entities
    title: Corona Virus
    show_header_toggle: false
    entities:
      - entity: sensor.germany_coronavirus_confirmed
        name: Bestätigt
      - entity: sensor.germany_coronavirus_current
        name: Aktuell
      - entity: sensor.germany_coronavirus_recovered
        name: Geheilt
      - entity: sensor.germany_coronavirus_deaths
        name: Tote

  - type: picture-glance
    title: Wetter
    entities: []
    camera_image: camera.wetter

  - type: picture-glance
    title: Dortmund
    entities: []
    camera_image: camera.dortmund
